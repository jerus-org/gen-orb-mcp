//! {{orb_name}} MCP Server
//!
{{#if description}}
//! {{description}}
//!
{{/if}}
//! This library provides an MCP server that exposes the {{orb_name}} CircleCI orb
//! as resources for AI coding assistants.
//!
//! ## Resources
//!
//! The server exposes the following resource URIs:
//!
{{#each commands}}
//! - `{{uri}}` - Command: {{name}}
{{/each}}
{{#each jobs}}
//! - `{{uri}}` - Job: {{name}}
{{/each}}
{{#each executors}}
//! - `{{uri}}` - Executor: {{name}}
{{/each}}
//! - `orb://overview` - Full orb summary
//!
//! Generated by gen-orb-mcp.

use pmcp::server::simple_resources::{ResourceCollection, StaticResource};
use pmcp::Server;

/// Create the MCP server for the {{orb_name}} orb.
///
/// This function builds a fully configured MCP server with all orb
/// commands, jobs, and executors exposed as static resources.
pub fn create_server() -> Server {
    let mut resources = ResourceCollection::new();

    // Add overview resource
    let overview = StaticResource::new_text(
        "orb://overview",
        OVERVIEW_CONTENT,
    )
    .with_name("{{orb_name}} Overview")
    .with_description("Complete overview of the {{orb_name}} CircleCI orb");
    resources = resources.add_static(overview);

{{#each commands}}
    // Command: {{name}}
    let resource = StaticResource::new_text(
        "{{uri}}",
        r##"{{json_content}}"##,
    )
    .with_name("{{name}}")
    .with_description("Command: {{name}}{{#if description}} - {{description}}{{/if}}");
    resources = resources.add_static(resource);

{{/each}}
{{#each jobs}}
    // Job: {{name}}
    let resource = StaticResource::new_text(
        "{{uri}}",
        r##"{{json_content}}"##,
    )
    .with_name("{{name}}")
    .with_description("Job: {{name}}{{#if description}} - {{description}}{{/if}}");
    resources = resources.add_static(resource);

{{/each}}
{{#each executors}}
    // Executor: {{name}}
    let resource = StaticResource::new_text(
        "{{uri}}",
        r##"{{json_content}}"##,
    )
    .with_name("{{name}}")
    .with_description("Executor: {{name}}{{#if description}} - {{description}}{{/if}}");
    resources = resources.add_static(resource);

{{/each}}
    Server::builder()
        .name("{{orb_name}}-mcp")
        .version("{{version}}")
        .resources(resources)
        .build()
        .expect("Failed to build MCP server")
}

/// Overview content for the orb.
const OVERVIEW_CONTENT: &str = r##"# {{orb_name}} CircleCI Orb

{{#if description}}
{{description}}

{{/if}}
## Commands ({{length commands}})

{{#each commands}}
### {{name}}
{{#if description}}
{{description}}
{{/if}}

URI: `{{uri}}`

{{#if parameters}}
**Parameters:**
{{#each parameters}}
- `{{name}}` ({{param_type}}{{#unless required}}, optional{{/unless}}){{#if description}}: {{description}}{{/if}}
{{/each}}
{{/if}}

{{/each}}
## Jobs ({{length jobs}})

{{#each jobs}}
### {{name}}
{{#if description}}
{{description}}
{{/if}}

URI: `{{uri}}`

{{#if executor}}
**Executor:** {{executor}}
{{/if}}

{{#if parameters}}
**Parameters:**
{{#each parameters}}
- `{{name}}` ({{param_type}}{{#unless required}}, optional{{/unless}}){{#if description}}: {{description}}{{/if}}
{{/each}}
{{/if}}

{{/each}}
## Executors ({{length executors}})

{{#each executors}}
### {{name}}
{{#if description}}
{{description}}
{{/if}}

URI: `{{uri}}`

{{#if config.docker_images}}
**Docker Images:**
{{#each config.docker_images}}
- {{this}}
{{/each}}
{{/if}}

{{#if config.resource_class}}
**Resource Class:** {{config.resource_class}}
{{/if}}

{{#if parameters}}
**Parameters:**
{{#each parameters}}
- `{{name}}` ({{param_type}}{{#unless required}}, optional{{/unless}}){{#if description}}: {{description}}{{/if}}
{{/each}}
{{/if}}

{{/each}}
"##;

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_create_server() {
        let server = create_server();
        // Basic smoke test - server should be created without panicking
        let _ = server;
    }
}
