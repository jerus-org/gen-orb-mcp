# gen-orb-mcp: Finalized Project Plan

## Project Overview

**gen-orb-mcp** generates Model Context Protocol (MCP) servers from CircleCI orb definitions, enabling AI coding assistants to understand and work with private orbs.

**Repository:** jerus-org/gen-orb-mcp  
**Developer:** Solo (Jeremiah Russell) with Claude Code support  
**Time Commitment:** 15 hours/week (~2 days/week)  
**Timeline:** ~25 weeks adjusted for part-time (vs 10 weeks full-time)

---

## Answers to Clarifying Questions

### Project Scope & Priorities

**Q1. Team Size:** Solo project with Claude Code support

**Q2. MVP Priority:** Option B - More general solution from start
- Will use circleci-toolkit as first implementation case
- Tool should work with any orb, not just one

**Q3. Multi-Version Support:** Not MVP
- Single version in Phase 1
- Multi-version in Phase 2 (Enhanced)

### Technical Decisions

**Q4. Versioning Strategy:** Last 5 versions initially
- May make earliest version configurable later
- Affects delta encoding design

**Q5. Repository Location:** Option A - jerus-org organization
- Aligns with existing projects
- Same governance as circleci-toolkit

**Q6. Binary Platforms:** Linux only for MVP
- x86_64-unknown-linux-gnu
- Others (macOS, Windows) can be added later if demand requires
- Sufficient for CI use case (running in CircleCI)

### Privacy & Deployment

**Q7. Privacy Requirements:** Must support private registries from MVP
- Tool is for private orbs
- Cannot expose private orb data in public registries
- Critical requirement, not optional

**Q8. Container Registry:** 
- Docker Hub (primary, as currently used)
- Private registry with suitable configuration options
- Must support both in MVP

### CircleCI Integration

**Q9. Repository Access:** Yes
- Ownership on repositories and CI
- Can configure all necessary settings

**Q10. Release Frequency:** As needed
- Not on fixed schedule
- Driven by features/fixes

**Q11. Patch Releases:** Yes
- Support semantic versioning fully
- MAJOR.MINOR.PATCH all supported

**Q12. Testing Approach:** Yes
- Can test with pre-release tags
- Standard CircleCI testing workflow

### Open Source Strategy

**Q13. Open Source Timing:** Scaffolding early, full release in Phase 2
- Reserve name on crates.io during Phase 1
- Include roadmap in README indicating future features
- Prevents name squatting
- Shows project direction to community

**Q14. License:** Dual MIT/Apache-2.0 (Rust standard)
- Follows CLAUDE.md policy
- LICENSE-MIT and LICENSE-APACHE files

**Q15. Documentation Location:** Option C - Both
- Summary in main README
- Detailed docs in docs/mcp-server.md
- Follows standard pattern

**Q16. Announcement Channel:** Public blog on www.jrussell.ie
- May also announce on CircleCI Discuss
- Optional HN/Reddit depending on reception

### Implementation Details

**Q17. Development Environment:**
- OS: Linux
- Experience: Experienced Rust developer
- IDE: VSCode

**Q18. CI/CD Platform:** CircleCI
- **Critical:** Must use CircleCI, not GitHub Actions
- Follows CLAUDE.md organizational standard
- Uses circleci-toolkit orb

**Q19. Smart Router Priority:** Phase 3
- Not MVP, not Enhanced
- Evaluate need after Phase 2 usage

**Q20. Time Commitment:** 15 hours per week
- ~2 days per week
- Extends timelines by ~2.5x
- MVP: 6-8 weeks ‚Üí 15-20 weeks
- Enhanced: 8-10 weeks ‚Üí 20-25 weeks

---

## Alignment with CLAUDE.md Standards

### Project Structure (Mandatory Workspace)

```
gen-orb-mcp/
‚îú‚îÄ‚îÄ Cargo.toml                      # Workspace manifest
‚îú‚îÄ‚îÄ crates/
‚îÇ   ‚îî‚îÄ‚îÄ gen-orb-mcp/               # Single crate (for now)
‚îÇ       ‚îú‚îÄ‚îÄ Cargo.toml              # Inherits from workspace
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ main.rs             # CLI entry
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ lib.rs              # Library
‚îÇ       ‚îú‚îÄ‚îÄ tests/
‚îÇ       ‚îú‚îÄ‚îÄ README.md               # Crate-specific
‚îÇ       ‚îú‚îÄ‚îÄ CHANGELOG.md            # Generated by gen-changelog
‚îÇ       ‚îú‚îÄ‚îÄ LICENSE-APACHE
‚îÇ       ‚îú‚îÄ‚îÄ LICENSE-MIT
‚îÇ       ‚îú‚îÄ‚îÄ release.toml            # Crate release config
‚îÇ       ‚îî‚îÄ‚îÄ release-hook.sh         # CHANGELOG generator
‚îú‚îÄ‚îÄ tests/                          # Shared integration tests
‚îú‚îÄ‚îÄ PRLOG.md                        # Workspace PR log
‚îú‚îÄ‚îÄ README.md                       # Workspace README
‚îú‚îÄ‚îÄ CONTRIBUTING.md
‚îú‚îÄ‚îÄ CODE_OF_CONDUCT.md
‚îú‚îÄ‚îÄ SECURITY.md
‚îú‚îÄ‚îÄ rustfmt.toml
‚îú‚îÄ‚îÄ release.toml                    # Workspace release config
‚îú‚îÄ‚îÄ deny.toml                       # cargo-deny audit
‚îú‚îÄ‚îÄ renovate.json                   # Dependency updates
‚îî‚îÄ‚îÄ justfile                        # Task automation
```

### Release Configuration

**Workspace `release.toml`:**
```toml
sign-tag = true
sign-commit = true
consolidate-commits = true
allow-branch = ["main"]
pre-release-replacements = []
```

**Crate `release.toml`:**
```toml
pre-release-commit-message = "chore: Release gen-orb-mcp v{{version}}"
tag-message = "{{tag_name}}"
tag-name = "gen-orb-mcp-v{{version}}"
pre-release-hook = ["./release-hook.sh"]
pre-release-replacements = [
    { file = "README.md", search = "gen-orb-mcp = \"\\d+\\.\\d+\\.\\d+\"", replace = "gen-orb-mcp = \"{{version}}\"", exactly = 1 },
]
```

**Crate `release-hook.sh`:**
```bash
#!/bin/bash
set -exo pipefail
gen-changelog generate \
    --display-summaries \
    --name "CHANGELOG.md" \
    --package "gen-orb-mcp" \
    --repository-dir "../.." \
    --next-version "${NEW_VERSION:-${1}}"
```

### CI/CD Configuration

**CircleCI Config:** `.circleci/config.yml` + `.circleci/release.yml`

Following the pcu repository pattern with two separate workflows:

**config.yml (Validation):**
```yaml
version: 2.1

orbs:
  toolkit: jerus-org/circleci-toolkit@4.2.0

workflows:
  validation:
    jobs:
      - toolkit/label
      - toolkit/required_builds
      - toolkit/optional_builds
      - toolkit/test_doc_build
      - toolkit/common_tests
      - toolkit/idiomatic_rust
      - toolkit/security
      - toolkit/update_prlog
```

**release.yml (Release):**
```yaml
version: 2.1

orbs:
  toolkit: jerus-org/circleci-toolkit@4.2.0

commands:
  get_next_version: # Enhanced with --prefix support
  check_crates_io_version: # Recovery from partial failures
  make_cargo_release: # Conditional publish
  make_github_release: # GitHub release + PRLOG update

jobs:
  release-crate:
    # Full release sequence
```

**Tag Format:** `gen-orb-mcp-v{VERSION}`

**See:** `CIRCLECI_SETUP_GUIDE.md` for complete configuration

### Release Process (Aligned with CLAUDE.md)

1. **Local Release:**
   ```bash
   cd crates/gen-orb-mcp
   cargo release patch  # or minor/major
   ```

2. **Creates:**
   - CHANGELOG.md (via release-hook.sh)
   - Git tag: `gen-orb-mcp-v0.1.0`
   - Git commit with version bump

3. **Push:**
   ```bash
   git push origin main --tags
   ```

4. **GitHub Release:**
   - Manually create GitHub release from tag
   - Or use CI to auto-create

5. **CircleCI Triggered:**
   - Tag matches filter: `gen-orb-mcp-v.*`
   - Runs `toolkit/rust-publish` job
   - Publishes to crates.io

6. **Update PRLOG.md:**
   - Mark release date
   - Create new UNRELEASED section

---

## Revised Timeline (15hrs/week)

### Phase 1: MVP (15-20 weeks)

**Weeks 1-5: Core Parser**
- Repository setup (1 week)
- Orb YAML parser (2 weeks)
- CLI interface (2 weeks)

**Weeks 6-10: MCP Server Generation**
- Template system (2 weeks)
- Resource generation (2 weeks)
- pmcp integration (1 week)

**Weeks 11-13: Binary Build**
- Rust compiler integration (2 weeks)
- End-to-end testing (1 week)

**Weeks 14-17: CI/CD Integration**
- CircleCI integration (2 weeks)
- circleci-toolkit integration (1 week)
- Developer testing (1 week)

**Weeks 18-20: Release**
- Documentation (2 weeks)
- MVP release v0.1.0 (1 week)

**MVP Deliverable:** gen-orb-mcp v0.1.0
- Single-version MCP server generation
- Linux binary only
- CircleCI integration
- Private registry support
- Name reserved on crates.io with roadmap

### Phase 2: Enhanced (20-25 weeks after MVP)

**Weeks 21-26: Multi-Version Support**
- Git integration (2 weeks)
- Delta encoding (3 weeks)
- Version detection (1 week)

**Weeks 27-33: Migration Tooling**
- Migration schema (2 weeks)
- Migration engine (3 weeks)
- Tool integration (2 weeks)

**Weeks 34-38: Multiple Formats**
- Container builder (3 weeks)
- Source distribution (1 week)
- Skill file generator (1 week)

**Weeks 39-45: Advanced Features**
- Config validation (3 weeks)
- Enhanced release v0.2.0 (4 weeks)

### Phase 3: Smart Router (Optional, 10-15 weeks)
- Evaluate need after Phase 2 usage
- Defer unless clearly needed

---

## Technology Stack (CLAUDE.md Aligned)

### Core Dependencies

```toml
[dependencies]
# MCP Protocol
pmcp = "1.8"

# YAML Processing
serde = { version = "1.0", features = ["derive"] }
serde_yaml = "0.9"

# CLI (following project standards)
clap = { version = "4.0", features = ["derive"] }

# Error Handling
anyhow = "1.0"
thiserror = "1.0"

# Async Runtime
tokio = { version = "1.0", features = ["full"] }

# Template Engine
handlebars = "5.0"

# Logging
tracing = "0.1"
tracing-subscriber = "0.3"

[dev-dependencies]
tempfile = "3.0"
trycmd = "0.15"        # CLI testing per CLAUDE.md
criterion = "0.5"      # Benchmarks per CLAUDE.md
```

### Build Tools

- Rust 1.85 (or MSRV as needed)
- `jerusdp/ci-rust:1.85` Docker image
- CircleCI for CI/CD
- `circleci-toolkit` orb
- `gen-changelog` for CHANGELOG generation
- `cargo release` for publishing
- `pcu` for version management
- `nextsv` for semantic versioning

---

## MVP Scope (Revised)

### In Scope

‚úÖ Parse any CircleCI orb YAML  
‚úÖ Generate MCP server (single version)  
‚úÖ Binary deployment (Linux x86_64 only)  
‚úÖ Private registry support (Docker Hub + private)  
‚úÖ CLI interface  
‚úÖ Basic resources (commands, jobs, executors)  
‚úÖ CircleCI integration with circleci-toolkit  
‚úÖ Workspace structure per CLAUDE.md  
‚úÖ Proper release.toml configuration  
‚úÖ CHANGELOG.md generation via gen-changelog  
‚úÖ PRLOG.md tracking  
‚úÖ Name reservation on crates.io  

### Out of Scope (Phase 2)

‚ùå Multi-version support  
‚ùå Delta encoding  
‚ùå Migration tooling  
‚ùå Container deployment  
‚ùå Source distribution  
‚ùå Skill file generation  
‚ùå macOS/Windows binaries  

### Out of Scope (Phase 3)

‚ùå Smart router  
‚ùå Context-aware version routing  

---

## First Implementation Case

**Repository:** jerus-org/circleci-toolkit  
**Purpose:** Validate gen-orb-mcp with real-world orb  
**Integration:** Add MCP generation to toolkit release workflow  

**Workflow:**
1. Develop gen-orb-mcp to MVP
2. Test with circleci-toolkit orb
3. Integrate into toolkit CI/CD
4. Use as reference implementation
5. Generalize for other orbs

---

## Privacy & Security Requirements

### Critical Privacy Features (MVP)

1. **Private Registry Support**
   - Support Docker Hub private repositories
   - Support self-hosted private registries
   - Configurable registry URLs
   - Authentication credential handling

2. **No Public Data Exposure**
   - Private orb definitions never sent to public services
   - Generated servers contain orb data (so must be private)
   - Container images must be pushable to private registries
   - No telemetry or phone-home

3. **Offline Operation**
   - MCP server runs entirely offline
   - No external dependencies at runtime
   - All orb data embedded in server

### Configuration Example

```bash
# Generate with private registry
gen-orb-mcp generate \
  --orb-path ./src/@orb.yml \
  --output ./dist/ \
  --format container \
  --registry registry.mycompany.internal \
  --registry-auth-env DOCKER_PASSWORD
```

---

## Success Metrics (Adjusted)

### MVP Success (Week 20)
- ‚úÖ gen-orb-mcp v0.1.0 published to crates.io
- ‚úÖ circleci-toolkit using generated MCP server
- ‚úÖ Successfully generates MCP server for any orb
- ‚úÖ Private registry deployment working
- ‚úÖ Documentation complete
- ‚úÖ < 3 critical bugs in first month

### Enhanced Success (Week 45)
- ‚úÖ gen-orb-mcp v0.2.0 published
- ‚úÖ Multi-version support working
- ‚úÖ 2+ other orbs using the tool
- ‚úÖ 100+ crates.io downloads
- ‚úÖ Community awareness established

---

## Immediate Next Steps

### This Week (Week 1)

**Day 1-2: Repository Setup**
- [ ] Create jerus-org/gen-orb-mcp repository
- [ ] Initialize workspace structure per CLAUDE.md
- [ ] Add Cargo.toml (workspace + crate)
- [ ] Add LICENSE-MIT, LICENSE-APACHE
- [ ] Add README.md with roadmap
- [ ] Add CONTRIBUTING.md, CODE_OF_CONDUCT.md, SECURITY.md
- [ ] Add justfile

**Day 3-4: CI/CD Setup**
- [ ] Create .circleci/config.yml using circleci-toolkit
- [ ] Add rustfmt.toml, deny.toml, renovate.json
- [ ] Configure CircleCI project
- [ ] Test CI pipeline

**Day 5: Initial Code**
- [ ] Create basic CLI structure with clap
- [ ] Add initial tests
- [ ] Verify CI passes

### Week 2-5: Core Parser Development
- Follow IMPLEMENTATION_PLAN.md tasks
- Adjust timeline for 15hrs/week pace
- Regular testing with circleci-toolkit orb

---

## Risk Assessment (Updated)

| Risk | Impact | Mitigation |
|------|--------|------------|
| Part-time pace slower | Medium | Clear milestones, Claude Code assistance |
| Private orb complexity | High | Test with circleci-toolkit early |
| Registry auth challenges | Medium | Document patterns, support multiple auth methods |
| pmcp SDK API changes | High | Pin version, monitor releases |
| CircleCI breaking changes | Low | Use stable toolkit patterns |
| Solo development bottleneck | Medium | Good documentation, automated testing |

---

## Questions Resolved ‚úì

All 20 clarifying questions have been answered and incorporated into this plan. The project is now ready to begin implementation following CLAUDE.md organizational standards.

**Key Decisions Made:**
- Solo project, 15hrs/week
- General solution (not toolkit-specific)
- Multi-version deferred to Phase 2
- Linux binary only for MVP
- Private registry support mandatory
- CircleCI with circleci-toolkit orb
- Dual MIT/Apache-2.0 license
- Name reservation in Phase 1
- Full release in Phase 2

---

## Using This Plan

**For Development:**
1. Follow workspace structure exactly
2. Use CircleCI (not GitHub Actions)
3. Integrate with circleci-toolkit orb
4. Use gen-changelog for CHANGELOG
5. Follow release.toml pattern

**With Claude Code:**
```
"Claude, start implementing Task 1.1 from IMPLEMENTATION_PLAN.md 
following the workspace structure in this document"
```

**For Releases:**
```bash
cd crates/gen-orb-mcp
cargo release patch
git push origin main --tags
# Create GitHub release from tag
# CircleCI auto-publishes to crates.io
```

**Documentation:**
- See updated ARCHITECTURE.md for CircleCI integration
- See updated IMPLEMENTATION_PLAN.md for detailed tasks
- See CIRCLECI_INTEGRATION_PLAN.md for toolkit integration

---

## Ready to Begin

All planning is complete. Next action:

```bash
# Create repository
gh repo create jerus-org/gen-orb-mcp --public

# Clone and set up
git clone https://github.com/jerus-org/gen-orb-mcp.git
cd gen-orb-mcp

# Begin Task 1.1: Repository Setup
# Use Claude Code to help scaffold structure
```

Let's build gen-orb-mcp! üöÄ
